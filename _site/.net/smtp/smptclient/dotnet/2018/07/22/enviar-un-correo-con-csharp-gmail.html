<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Enviar un correo con C# y Gmail. | Programación con C#</title>
<meta name="generator" content="Jekyll v3.5.1" />
<meta property="og:title" content="Enviar un correo con C# y Gmail." />
<meta property="og:locale" content="en_US" />
<meta name="description" content="En el desarrollo de software empresarial enviar correos electrónicos es un requerimiento muy frecuente y en este tutorial te mostramos como hacerlo usando C#, .Net Core 2.0 y Visual Studio Code. Actualmente existen varias biblioteca para enviar correos como SendGrid o MailKit, sin embargo en este tutorial se utiliza la clase SmtpClient parte de .NET Standard 2.0." />
<meta property="og:description" content="En el desarrollo de software empresarial enviar correos electrónicos es un requerimiento muy frecuente y en este tutorial te mostramos como hacerlo usando C#, .Net Core 2.0 y Visual Studio Code. Actualmente existen varias biblioteca para enviar correos como SendGrid o MailKit, sin embargo en este tutorial se utiliza la clase SmtpClient parte de .NET Standard 2.0." />
<link rel="canonical" href="http://0.0.0.0:8080/.net/smtp/smptclient/dotnet/2018/07/22/enviar-un-correo-con-csharp-gmail.html" />
<meta property="og:url" content="http://0.0.0.0:8080/.net/smtp/smptclient/dotnet/2018/07/22/enviar-un-correo-con-csharp-gmail.html" />
<meta property="og:site_name" content="Programación con C#" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-07-22T12:30:55+00:00" />
<script type="application/ld+json">
{"description":"En el desarrollo de software empresarial enviar correos electrónicos es un requerimiento muy frecuente y en este tutorial te mostramos como hacerlo usando C#, .Net Core 2.0 y Visual Studio Code. Actualmente existen varias biblioteca para enviar correos como SendGrid o MailKit, sin embargo en este tutorial se utiliza la clase SmtpClient parte de .NET Standard 2.0.","@type":"BlogPosting","url":"http://0.0.0.0:8080/.net/smtp/smptclient/dotnet/2018/07/22/enviar-un-correo-con-csharp-gmail.html","headline":"Enviar un correo con C# y Gmail.","dateModified":"2018-07-22T12:30:55+00:00","datePublished":"2018-07-22T12:30:55+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://0.0.0.0:8080/.net/smtp/smptclient/dotnet/2018/07/22/enviar-un-correo-con-csharp-gmail.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://0.0.0.0:8080/feed.xml" title="Programación con C#" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Programación con C#</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Enviar un correo con C# y Gmail.</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2018-07-22T12:30:55+00:00" itemprop="datePublished">Jul 22, 2018
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>En el desarrollo de software empresarial enviar correos electrónicos es un requerimiento muy frecuente y en este tutorial te mostramos como hacerlo usando C#, .Net Core 2.0  y Visual Studio Code.
Actualmente existen varias biblioteca para enviar correos como SendGrid o MailKit, sin embargo en este tutorial se utiliza la clase <a href="https://docs.microsoft.com/en-us/dotnet/api/system.net.mail.smtpclient?view=netframework-4.7.2">SmtpClient</a> 
parte  de .NET Standard 2.0.</p>

<p><img src="http://0.0.0.0:8080/img/adult-business-businessman-1061588.jpg" alt="Revisando el correo electrónico" title="Email en negocios" /></p>

<p>Este artículo representa una guía paso a paso para enviar un correo electrónico usando C# y una cuenta de Gmail.
Se asume que tienes instalado el SDK de <a href="https://www.microsoft.com/net/download">.NET Core</a> y el editor de código <a href="https://code.visualstudio.com/">Visual Studio Code</a>. Adicionalmente se creará una solución para poder abrir el proyecto con Visual Studio.</p>

<p>Se creará una biblioteca de clases que tiene como única función enviar correos. Después se usa esta clase en un proyecto de consola. Esta clase se puede usar en cualquier otrp tipo de proyectos que soporte .NET Standard.
El caso de uso cubre está clase es : Una aplicación tiene asignada una cuenta de correo con la cuál envía todos los correos al destinatario especificado.</p>

<h2 id="configuración-de-gmail">Configuración de Gmail</h2>

<p>Es necesario permitir el  permitir el acceso a aplicaciones no seguran desde la configuración de Gmail tal como se describe en la 
<a href="https://support.google.com/accounts/answer/6010255?hl=es-41">documentación de Gmail</a>.</p>

<p><img src="http://0.0.0.0:8080/img/AccesoAplicacionesMenosSeguras.PNG" alt="alt text" title="Pantalla de gmail" /></p>

<p>La configuracion necesaria para el cliente de SMTP de acuerdo a la <a href="https://support.google.com/mail/answer/7126229?visit_id=1-636683482170517029-2536242402&amp;hl=es&amp;rd=1">documentación de Gmail</a> 
es la siguiente:</p>

<table>
  <thead>
    <tr>
      <th>Parametro</th>
      <th>Valor</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Servidor de correo saliente (SMTP)</td>
      <td>smtp.gmail.com</td>
    </tr>
    <tr>
      <td>Requiere TLS</td>
      <td>Sí (si está disponible)</td>
    </tr>
    <tr>
      <td>Requiere autenticación</td>
      <td>Sí</td>
    </tr>
    <tr>
      <td>Puerto para TLS/STARTTLS</td>
      <td>587</td>
    </tr>
    <tr>
      <td>Nombre completo o nombre mostrado</td>
      <td>Tu nombre</td>
    </tr>
    <tr>
      <td>Nombre de la cuenta, nombre de usuario o dirección de correo electrónico</td>
      <td>Tu dirección de correo electrónico completa</td>
    </tr>
    <tr>
      <td>Contraseña</td>
      <td>Tu contraseña de Gmail</td>
    </tr>
  </tbody>
</table>

<p>Con esta configuración se creara un archivo XML que la aplicación leerá al momento que se crear una instancia de la clase. 
Esto tiene como proposito hacer la aplicación no dependa de la configuración y en caso de ser necesario actualizar  la contraseña o cambiar la  cuenta no sea necesario recompilar la aplicación nuevamente.</p>
<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8" ?&gt;</span>
<span class="nt">&lt;configuration&gt;</span>
  <span class="nt">&lt;host&gt;</span>smtp.gmail.com<span class="nt">&lt;/host&gt;</span>
  <span class="nt">&lt;port&gt;</span>587<span class="nt">&lt;/port&gt;</span>
  <span class="nt">&lt;user&gt;</span>tucuenta@gmail.com<span class="nt">&lt;/user&gt;</span>
  <span class="nt">&lt;password&gt;</span>contraseñagmail<span class="nt">&lt;/password&gt;</span>
  <span class="nt">&lt;enableSsl&gt;</span>true<span class="nt">&lt;/enableSsl&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</code></pre>
</div>
<h2 id="preparando-el-proyecto-en-visual-studio-code">Preparando el proyecto en Visual Studio Code</h2>

<p>Para realizarlo ejecuta en la terminal o consola los siguientes comandos. Ejecuta línea por línea ya que se colocarón más de un comando por descripción.</p>

<ol>
  <li>
    <p>Se creará una solución llamada <em>EnviarCorreo</em> y dos proyectos, el primero una biblioteca de clases llamada <em>EmailService</em> y el segundo proyecto es una aplicacion de consola llamada <em>EmailServiceCliente</em>.</p>

    <div class="language-sh highlighter-rouge"><pre class="highlight"><code>dotnet new sln -o EnviarCorreo
dotnet new classlib -o EnviarCorreo/EmailService
dotnet new console -o EnviarCorreo/EmailServiceCliente
</code></pre>
    </div>
  </li>
  <li>Agregar los proyectos a la solución,
    <div class="language-sh highlighter-rouge"><pre class="highlight"><code>dotnet sln EnviarCorreo/EnviarCorreo.sln add EnviarCorreo/EmailServiceCliente/EmailServiceCliente.csproj
dotnet sln EnviarCorreo/EnviarCorreo.sln add EnviarCorreo/EmailServiceCliente/EmailServiceCliente.csproj
</code></pre>
    </div>
  </li>
  <li>El proyecto EmailServiceCliente tendra una referencia al proyecto EmailService para poder utilizarlo.
    <div class="language-sh highlighter-rouge"><pre class="highlight"><code> dotnet add EnviarCorreo/EmailServiceCliente/EmailServiceCliente.csproj reference EnviarCorreo/EmailService/EmailService.csproj
</code></pre>
    </div>
  </li>
  <li>Abir la carpeta <em>EnviarCorreo\EmailService</em> (<code class="highlighter-rouge">cd EnviarCorreo\EmailService</code>) y agregar la referencia al paquete de Nuget <code class="highlighter-rouge">Microsoft.Extensions.Configuration.Xml</code> esta es necesaria para poder leer el archivo <em>XML</em>.
    <div class="language-sh highlighter-rouge"><pre class="highlight"><code> dotnet add package Microsoft.Extensions.Configuration.Xml
</code></pre>
    </div>
  </li>
  <li>
    <p>Crear un nuevo archvio llamado <em>Configuracion.xml</em> xml (Windows <code class="highlighter-rouge">type NUL &gt; Configuration.xml</code> , Linux <code class="highlighter-rouge">touch Configuracion.xml</code>).</p>
  </li>
  <li>Abrir la carpeta <em>EnviarCorreo</em> con Visual Studio Code.
    <div class="language-sh highlighter-rouge"><pre class="highlight"><code> code ..
</code></pre>
    </div>
  </li>
  <li>Editar el archivo del proyecto <em>EnviarCorreo\EmailService</em> para que siempre coloque a la salida el archivo de configurcion.
    <div class="language-xml highlighter-rouge"><pre class="highlight"><code> <span class="nt">&lt;ItemGroup&gt;</span>
     <span class="nt">&lt;None</span> <span class="na">Update=</span><span class="s">"Configuracion.xml"</span><span class="nt">&gt;</span>
       <span class="nt">&lt;CopyToOutputDirectory&gt;</span>Always<span class="nt">&lt;/CopyToOutputDirectory&gt;</span>
     <span class="nt">&lt;/None&gt;</span>
   <span class="nt">&lt;/ItemGroup&gt;</span>
</code></pre>
    </div>
    <h3 id="código-biblioteca-de-clases">Código biblioteca de clases.</h3>
  </li>
</ol>

<p>Esta clase esta compuesta por 2 campos y una propiedad. En el constructor se inicializa la propiedad <code class="highlighter-rouge">Configuration</code> responsable de leer los archivos de XML y se
inicializa el cliente SMTP con los parámetros de configuración.</p>

<p>El método <code class="highlighter-rouge">EnviarCorreo(string , string , string ,bool esHtlm = false)</code> utiliza un paámetro opcional que define si el mensaje es HTML. Por default envia texto.
El método  <code class="highlighter-rouge">EnviarCorreo(MailMessage)</code> esta pensado para poder construir un objecto MailMessage y poder aprovechar todas las capacidades este objecto como adjuntar archivos</p>

<div class="language-cs highlighter-rouge"><pre class="highlight"><code><span class="k">using</span> <span class="nn">Microsoft.Extensions.Configuration</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.IO</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Mail</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">EnviarCorreoElectronico</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">GestorCorreo</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="n">SmtpClient</span> <span class="n">cliente</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">static</span> <span class="n">IConfiguration</span> <span class="n">Configuration</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">private</span> <span class="n">MailMessage</span> <span class="n">email</span><span class="p">;</span>
        <span class="k">public</span> <span class="nf">GestorCorreo</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">InicializaConfiguracion</span><span class="p">();</span>
            <span class="n">cliente</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SmtpClient</span><span class="p">(</span><span class="n">Configuration</span><span class="p">[</span><span class="s">"host"</span><span class="p">],</span> <span class="n">Int32</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">Configuration</span><span class="p">[</span><span class="s">"port"</span><span class="p">]))</span>
            <span class="p">{</span>
                <span class="n">EnableSsl</span> <span class="p">=</span> <span class="n">Boolean</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">Configuration</span><span class="p">[</span><span class="s">"enableSsl"</span><span class="p">]),</span>
                <span class="n">DeliveryMethod</span> <span class="p">=</span> <span class="n">SmtpDeliveryMethod</span><span class="p">.</span><span class="n">Network</span><span class="p">,</span>
                <span class="n">UseDefaultCredentials</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span>
                <span class="n">Credentials</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">NetworkCredential</span><span class="p">(</span><span class="n">Configuration</span><span class="p">[</span><span class="s">"user"</span><span class="p">],</span> <span class="n">Configuration</span><span class="p">[</span><span class="s">"password"</span><span class="p">])</span>
            <span class="p">};</span>
        <span class="p">}</span>
        <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">InicializaConfiguracion</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">builder</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ConfigurationBuilder</span><span class="p">()</span>
                                    <span class="p">.</span><span class="nf">SetBasePath</span><span class="p">(</span><span class="n">Directory</span><span class="p">.</span><span class="nf">GetCurrentDirectory</span><span class="p">())</span>
                                    <span class="p">.</span><span class="nf">AddXmlFile</span><span class="p">(</span><span class="s">"Configuracion.xml"</span><span class="p">);</span>
            <span class="n">Configuration</span> <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">Build</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">EnviarCorreo</span><span class="p">(</span><span class="kt">string</span> <span class="n">destinatario</span><span class="p">,</span> <span class="kt">string</span> <span class="n">asunto</span><span class="p">,</span> <span class="kt">string</span> <span class="n">mensaje</span><span class="p">,</span><span class="kt">bool</span> <span class="n">esHtlm</span> <span class="p">=</span> <span class="k">false</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">email</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MailMessage</span><span class="p">(</span><span class="n">Configuration</span><span class="p">[</span><span class="s">"user"</span><span class="p">],</span> <span class="n">destinatario</span><span class="p">,</span> <span class="n">asunto</span><span class="p">,</span> <span class="n">mensaje</span><span class="p">);</span>
            <span class="n">email</span><span class="p">.</span><span class="n">IsBodyHtml</span> <span class="p">=</span> <span class="n">esHtlm</span><span class="p">;</span>
            <span class="n">cliente</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="n">email</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">EnviarCorreo</span><span class="p">(</span><span class="n">MailMessage</span> <span class="n">message</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">cliente</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">EnviarCorreoAsync</span><span class="p">(</span><span class="n">MailMessage</span> <span class="n">message</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">await</span> <span class="n">cliente</span><span class="p">.</span><span class="nf">SendMailAsync</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<h3 id="código-aplicación-de-consola">Código Aplicación de consola.</h3>
<p>Muestra como usar la clase GestorCorreo.</p>

<div class="language-cs highlighter-rouge"><pre class="highlight"><code>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">EmailService</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Mail</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">EmailServiceCliente</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">try</span>
            <span class="p">{</span>
                <span class="n">GestorCorreo</span> <span class="n">gestor</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GestorCorreo</span><span class="p">();</span>
                <span class="c1">//Aqui se puede definir agregar adjuntos
</span>                <span class="n">MailMessage</span> <span class="n">correo</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MailMessage</span><span class="p">(</span><span class="s">"tucuenta@gmail.com"</span><span class="p">,</span> <span class="s">"tucuenta@gmail.com"</span><span class="p">,</span> <span class="s">"Reporte Mensual."</span><span class="p">,</span> <span class="s">"Por favor ve el reporte adjunto."</span><span class="p">);</span>  
                <span class="n">gestor</span><span class="p">.</span><span class="nf">EnviarCorreo</span><span class="p">(</span><span class="n">correo</span><span class="p">);</span>
                <span class="n">gestor</span><span class="p">.</span><span class="nf">EnviarCorreo</span><span class="p">(</span><span class="s">"tucuenta@gmail.com"</span><span class="p">,</span> <span class="s">"Prueba"</span><span class="p">,</span> <span class="s">"Mensaje en texto plano"</span><span class="p">);</span>
                <span class="c1">// Se tiene la idea de utilizar un archivo HTML como plantilla personalizare e invocar este metodo. 
</span>                <span class="n">gestor</span><span class="p">.</span><span class="nf">EnviarCorreo</span><span class="p">(</span><span class="s">"tucuenta@gmail.com"</span><span class="p">,</span> <span class="s">"Prueba"</span><span class="p">,</span> <span class="s">"&lt;h1&gt;Mensaje en HTML&lt;h1&gt;&lt;p&gt;&lt;s&gt;Super Awesome html Message.&lt;/s&gt;&lt;/p&gt;"</span><span class="p">,</span><span class="k">true</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre>
</div>
<h1 id="ejecutar">Ejecutar</h1>

<p>Abrir la terminal en la carpeta <em>EmailServiceCliente</em> y ejecutar <code class="highlighter-rouge">dotnet run</code></p>

<h1 id="para-llevar">Para llevar</h1>

<p>Puedes encontrar el código fuente el el repositorio de <a href="https://github.com/jahbenjah/CodigoBlog">Github</a>.</p>


  </div><a class="u-url" href="/.net/smtp/smptclient/dotnet/2018/07/22/enviar-un-correo-con-csharp-gmail.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Programación con C#</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Programación con C#</li><li><a class="u-email" href="mailto:j.benjamin.camacho@gmail.com">j.benjamin.camacho@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/jahbenjah"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">jahbenjah</span></a></li><li><a href="https://www.twitter.com/jbenjamincmcho"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">jbenjamincmcho</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>En este sitio encontraras articiulos sobre programación usando C# .</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
