<!DOCTYPE HTML>
<html lang="es" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Autorización con roles - El pequeño libro de ASP.NET Core</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Una introducción amigable para construir aplicaciones web con el framework ASP.NET Core.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../../favicon.svg">
        
        
        <link rel="shortcut icon" href="../../favicon.png">
        
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        
        <link rel="stylesheet" href="../../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../../chapters/your-first-application/index.html"><strong aria-hidden="true">1.</strong> Tú primera aplicación</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapters/your-first-application/get-the-sdk.html"><strong aria-hidden="true">1.1.</strong> Consigue el SDK</a></li><li class="chapter-item expanded "><a href="../../chapters/your-first-application/hello-world-in-csharp.html"><strong aria-hidden="true">1.2.</strong> Hola Mundo en C#</a></li><li class="chapter-item expanded "><a href="../../chapters/your-first-application/create-aspnetcore-project.html"><strong aria-hidden="true">1.3.</strong> Crear un proyecto de ASP.NET Core</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapters/mvc-basics/index.html"><strong aria-hidden="true">2.</strong> Fundamentos de MVC</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapters/mvc-basics/create-controller.html"><strong aria-hidden="true">2.1.</strong> Crear un controlador</a></li><li class="chapter-item expanded "><a href="../../chapters/mvc-basics/create-models.html"><strong aria-hidden="true">2.2.</strong> Crear modelos</a></li><li class="chapter-item expanded "><a href="../../chapters/mvc-basics/create-view.html"><strong aria-hidden="true">2.3.</strong> Crear una vista</a></li><li class="chapter-item expanded "><a href="../../chapters/mvc-basics/add-service-class.html"><strong aria-hidden="true">2.4.</strong> Agregar una clase de servicio</a></li><li class="chapter-item expanded "><a href="../../chapters/mvc-basics/use-dependency-injection.html"><strong aria-hidden="true">2.5.</strong> Usar inyección de dependencias</a></li><li class="chapter-item expanded "><a href="../../chapters/mvc-basics/finish-controller.html"><strong aria-hidden="true">2.6.</strong> Terminando el controlador</a></li><li class="chapter-item expanded "><a href="../../chapters/mvc-basics/update-the-layout.html"><strong aria-hidden="true">2.7.</strong> Actualizar la plantilla</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapters/add-external-packages/index.html"><strong aria-hidden="true">3.</strong> Agregando paquetes externos</a></li><li class="chapter-item expanded "><a href="../../chapters/use-a-database/index.html"><strong aria-hidden="true">4.</strong> Usando una base de datos</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapters/use-a-database/connect-to-a-database.html"><strong aria-hidden="true">4.1.</strong> Conectarse a una base de datos</a></li><li class="chapter-item expanded "><a href="../../chapters/use-a-database/update-context.html"><strong aria-hidden="true">4.2.</strong> Actualizando el contexto</a></li><li class="chapter-item expanded "><a href="../../chapters/use-a-database/create-migration.html"><strong aria-hidden="true">4.3.</strong> Crear una migración</a></li><li class="chapter-item expanded "><a href="../../chapters/use-a-database/create-service-class.html"><strong aria-hidden="true">4.4.</strong> Crear una nueva clase de servicio</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapters/add-more-features/index.html"><strong aria-hidden="true">5.</strong> Agregando más características</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapters/add-more-features/add-todo-items.html"><strong aria-hidden="true">5.1.</strong> Agregar nuevas tareas</a></li><li class="chapter-item expanded "><a href="../../chapters/add-more-features/complete-with-checkbox.html"><strong aria-hidden="true">5.2.</strong> Completar las tareas con una casilla de verificación</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapters/security-and-identity/index.html"><strong aria-hidden="true">6.</strong> Seguridad e Identidad</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapters/security-and-identity/require-authentication.html"><strong aria-hidden="true">6.1.</strong> Requerir autenticación</a></li><li class="chapter-item expanded "><a href="../../chapters/security-and-identity/using-identity-in-the-application.html"><strong aria-hidden="true">6.2.</strong> Usando identidad en la aplicación</a></li><li class="chapter-item expanded "><a href="../../chapters/security-and-identity/authorization-with-roles.html" class="active"><strong aria-hidden="true">6.3.</strong> Autorización con roles</a></li><li class="chapter-item expanded "><a href="../../chapters/security-and-identity/more-resources.html"><strong aria-hidden="true">6.4.</strong> Más recursos</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapters/automated-testing/index.html"><strong aria-hidden="true">7.</strong> Pruebas automáticas</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapters/automated-testing/unit-testing.html"><strong aria-hidden="true">7.1.</strong> Pruebas unitarias</a></li><li class="chapter-item expanded "><a href="../../chapters/automated-testing/integration-testing.html"><strong aria-hidden="true">7.2.</strong> Pruebas de integración</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapters/deploy-the-application/index.html"><strong aria-hidden="true">8.</strong> Desplegando la aplicación</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapters/deploy-the-application/deploy-to-azure.html"><strong aria-hidden="true">8.1.</strong> Desplegando en Azure</a></li><li class="chapter-item expanded "><a href="../../chapters/deploy-the-application/deploy-with-docker.html"><strong aria-hidden="true">8.2.</strong> Desplegando con Docker</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapters/conclusion/index.html"><strong aria-hidden="true">9.</strong> Conclusión</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">El pequeño libro de ASP.NET Core</h1>

                    <div class="right-buttons">
                        
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        <a href="https://github.com/jahbenjah/little-aspnetcore-book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2><a class="header" href="#autorización-con-roles" id="autorización-con-roles">Autorización con roles</a></h2>
<p>Los roles son un enfoque común para el manejo de permisos y autorizaciones en una aplicación web. Por ejemplo, es común crear una rol de administrador que otorgue a los usuarios administradores más permisos o poder que los usuarios normales.</p>
<p>En este proyecto, agregará una página para Administrar usuarios que solo los administradores pueden ver. Si los usuarios normales intentan acceder a él, verán un error.</p>
<h3><a class="header" href="#agregar-una-página-administrar-usuarios" id="agregar-una-página-administrar-usuarios">Agregar una página Administrar usuarios</a></h3>
<p>Primero, crea un nuevo controlador:</p>
<p><strong>Controllers/ManageUsersController.cs</strong></p>
<pre><code class="language-csharp">using System;
using System.Linq;
using System.Threading.Tasks;
using Microsoft.AspNetCore.Mvc;
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Identity;
using AspNetCoreTodo.Models;
using Microsoft.EntityFrameworkCore;

namespace AspNetCoreTodo.Controllers
{
    [Authorize(Roles = &quot;Administrator&quot;)]
    public class ManageUsersController : Controller
    {
        private readonly UserManager&lt;ApplicationUser&gt;
            _userManager;
        
        public ManageUsersController(
            UserManager&lt;ApplicationUser&gt; userManager)
        {
            _userManager = userManager;
        }

        public async Task&lt;IActionResult&gt; Index()
        {
            var admins = (await _userManager
                .GetUsersInRoleAsync(&quot;Administrator&quot;))
                .ToArray();

            var everyone = await _userManager.Users
                .ToArrayAsync();

            var model = new ManageUsersViewModel
            {
                Administrators = admins,
                Everyone = everyone
            };

            return View(model);
        }
    }
}
</code></pre>
<p>La configuración de la propiedad <code>Roles</code> en el atributo <code>[Authorize]</code>garantizará que el usuario tenga que iniciar sesión <strong>y</strong> se le asigne el rol de Administrador para poder ver la página.</p>
<p>A continuación, crea un modelo para la vista:</p>
<p><strong>Models/ManageUsersViewModel.cs</strong></p>
<pre><code class="language-csharp">using System.Collections.Generic;

namespace AspNetCoreTodo.Models
{
    public class ManageUsersViewModel
    {
        public ApplicationUser[] Administrators { get; set; }

        public ApplicationUser[] Everyone { get; set;}
    }
}
</code></pre>
<p>Finalmente, cree una carpeta <code>Views/ManageUsers</code> y una vista para la acción <code>Index</code>:</p>
<p><strong>Views/ManageUsers/Index.cshtml</strong></p>
<pre><code class="language-html">@model ManageUsersViewModel

@{
    ViewData[&quot;Title&quot;] = &quot;Manage users&quot;;
}

&lt;h2&gt;@ViewData[&quot;Title&quot;]&lt;/h2&gt;

&lt;h3&gt;Administrators&lt;/h3&gt;

&lt;table class=&quot;table&quot;&gt;
    &lt;thead&gt;
        &lt;tr&gt;
            &lt;td&gt;Id&lt;/td&gt;
            &lt;td&gt;Email&lt;/td&gt;
        &lt;/tr&gt;
    &lt;/thead&gt;
    
    @foreach (var user in Model.Administrators)
    {
        &lt;tr&gt;
            &lt;td&gt;@user.Id&lt;/td&gt;
            &lt;td&gt;@user.Email&lt;/td&gt;
        &lt;/tr&gt;
    }
&lt;/table&gt;

&lt;h3&gt;Everyone&lt;/h3&gt;

&lt;table class=&quot;table&quot;&gt;
    &lt;thead&gt;
        &lt;tr&gt;
            &lt;td&gt;Id&lt;/td&gt;
            &lt;td&gt;Email&lt;/td&gt;
        &lt;/tr&gt;
    &lt;/thead&gt;
    
    @foreach (var user in Model.Everyone)
    {
        &lt;tr&gt;
            &lt;td&gt;@user.Id&lt;/td&gt;
            &lt;td&gt;@user.Email&lt;/td&gt;
        &lt;/tr&gt;
    }
&lt;/table&gt;
</code></pre>
<p>Inicie la aplicación e intente acceder a la ruta <code>/ManageUsers</code> mientras esté conectado como un usuario normal. Verás esta página de acceso denegado:</p>
<p><img src="access-denied.png" alt="Error de acceso denegado" /></p>
<p>Eso es porque a los usuarios no se les asigna automáticamente el rol de Administrador.</p>
<h3><a class="header" href="#crear-una-cuenta-de-administrador-de-prueba" id="crear-una-cuenta-de-administrador-de-prueba">Crear una cuenta de administrador de prueba</a></h3>
<p>Por razones obvias de seguridad, no es posible que nadie registre una nueva cuenta de administrador. De hecho, el rol de administrador ni siquiera existe en la base de datos todavía.</p>
<p>Puede agregar el rol de administrador más una cuenta de administrador de prueba a la base de datos la primera vez que se inicie la aplicación. Agregar datos por primera vez a la base de datos se llama inicializar o <strong>sembrar</strong> la base de datos.</p>
<p>Crea una nueva clase en la raíz del proyecto llamada <code>SeedData</code>:</p>
<p><strong>SeedData.cs</strong></p>
<pre><code class="language-csharp">using System;
using System.Linq;
using System.Threading.Tasks;
using AspNetCoreTodo.Models;
using Microsoft.AspNetCore.Identity;
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.DependencyInjection;

namespace AspNetCoreTodo
{
    public static class SeedData
    {
        public static async Task InitializeAsync(
            IServiceProvider services)
        {
            var roleManager = services
                .GetRequiredService&lt;RoleManager&lt;IdentityRole&gt;&gt;();
            await EnsureRolesAsync(roleManager);

            var userManager = services
                .GetRequiredService&lt;UserManager&lt;ApplicationUser&gt;&gt;();
            await EnsureTestAdminAsync(userManager);
        }
    }
}
</code></pre>
<p>El método <code>InitializeAsync()</code> utiliza un <code>IServiceProvider</code> (la colección de servicios que se configura en el método <code>Startup.ConfigureServices()</code>) para obtener el <code>RoleManager</code> y el <code>UserManager</code> de ASP.NET Core Identity.</p>
<p>Agregue dos métodos más debajo del método <code>InitializeAsync()</code>. Primero, el método <code>VerifyRolesAsync()</code>:</p>
<pre><code class="language-csharp">private static async Task EnsureRolesAsync(
    RoleManager&lt;IdentityRole&gt; roleManager)
{
    var alreadyExists = await roleManager
        .RoleExistsAsync(Constants.AdministratorRole);
    
    if (alreadyExists) return;

    await roleManager.CreateAsync(
        new IdentityRole(Constants.AdministratorRole));
}
</code></pre>
<p>Este método verifica si existe un rol de <code>Administrador</code> en la base de datos. Si no, crea uno. En lugar de escribir repetidamente la cadena <code>&quot;Administrador&quot;</code>, cree una pequeña clase llamada <code>Constants</code> para mantener el valor:</p>
<p><strong>Constants.cs</strong></p>
<pre><code class="language-csharp">namespace AspNetCoreTodo
{
    public static class Constants
    {
        public const string AdministratorRole = &quot;Administrator&quot;;
    }
}
</code></pre>
<blockquote>
<p>Si lo desea, puede actualizar el <code>ManageUsersController</code> para usar este valor constante también.</p>
</blockquote>
<p>A continuación, escriba el método <code>EnsureTestAdminAsync()</code>:</p>
<p><strong>SeedData.cs</strong></p>
<pre><code class="language-csharp">private static async Task EnsureTestAdminAsync(
    UserManager&lt;ApplicationUser&gt; userManager)
{
    var testAdmin = await userManager.Users
        .Where(x =&gt; x.UserName == &quot;admin@todo.local&quot;)
        .SingleOrDefaultAsync();

    if (testAdmin != null) return;

    testAdmin = new ApplicationUser
    {
        UserName = &quot;admin@todo.local&quot;,
        Email = &quot;admin@todo.local&quot;
    };
    await userManager.CreateAsync(
        testAdmin, &quot;NotSecure123!!&quot;);
    await userManager.AddToRoleAsync(
        testAdmin, Constants.AdministratorRole);
}
</code></pre>
<p>Si no hay un usuario con el nombre de usuario <code>admin@todo.local</code> en la base de datos, este método creará uno y le asignará una contraseña temporal. Después de iniciar sesión por primera vez, ¡debe cambiar la contraseña de la cuenta a algo seguro!</p>
<p>A continuación, debe indicar a su aplicación que ejecute esta lógica cuando se inicie. Modifique <code>Program.cs</code> y actualice <code>Main()</code>para llamar a un nuevo método, <code>InitializeDatabase()</code>:</p>
<p><strong>Program.cs</strong></p>
<pre><code class="language-csharp">public static void Main(string[] args)
{
    var host = BuildWebHost(args);
    InitializeDatabase(host);
    host.Run();
}
</code></pre>
<p>Luego, agregue el nuevo método a la clase debajo de <code>Main()</code>:</p>
<pre><code class="language-csharp">private static void InitializeDatabase(IWebHost host)
{
    using (var scope = host.Services.CreateScope())
    {
        var services = scope.ServiceProvider;

        try
        {
            SeedData.InitializeAsync(services).Wait();
        }
        catch (Exception ex)
        {
            var logger = services
                .GetRequiredService&lt;ILogger&lt;Program&gt;&gt;();
            logger.LogError(ex, &quot;Error occurred seeding the DB.&quot;);
        }
    }
}
</code></pre>
<p>Agregue esta declaración <code>using</code> al principio del archivo:</p>
<pre><code class="language-csharp">using Microsoft.Extensions.DependencyInjection;
</code></pre>
<p>Este método obtiene la colección de servicios que necesita <code>SeedData.InitializeAsync()</code> y luego ejecuta el método para inicializar la base de datos. Si algo sale mal, se registra un error.</p>
<blockquote>
<p>Como <code>InitializeAsync()</code> devuelve un <code>Task</code>, el método <code>Wait()</code>debe usarse para asegurarse de que finaliza antes de que la aplicación se inicie. Normalmente utilizarías &quot;esperar&quot; para esto, pero por razones técnicas no puedes usar &quot;esperar&quot; en la clase &quot;Programa&quot;. Esta es una rara excepción. ¡Debes usar <code>await</code> en cualquier otro lugar!</p>
</blockquote>
<p>Cuando inicie la aplicación a continuación, la cuenta <code>admin@todo.local</code> se creará y se le asignará el rol de Administrador. Intente iniciar sesión con esta cuenta y navegue a <code>http://localhost:5000/ManageUsers</code>. Verás una lista de todos los usuarios registrados para la aplicación.</p>
<blockquote>
<p>Como desafío adicional, intente agregar más funciones de administración a esta página. Por ejemplo, podría agregar un botón que le dé a un administrador la posibilidad de eliminar una cuenta de usuario.</p>
</blockquote>
<h3><a class="header" href="#verificar-la-autorización-en-una-vista" id="verificar-la-autorización-en-una-vista">Verificar la autorización en una vista</a></h3>
<p>El atributo <code>[Authorize]</code> facilita la verificación de autorización en un controlador o método de acción, pero ¿qué sucede si necesita verificar la autorización en una vista? Por ejemplo, sería bueno mostrar un enlace &quot;Administrar usuarios&quot; en la barra de navegación si el usuario que ha iniciado sesión es un administrador.</p>
<p>Puede inyectar el <code>UserManager</code> directamente en una vista para realizar estos tipos de comprobaciones de autorización. Para mantener sus vistas limpias y organizadas, cree una nueva vista parcial que agregará un elemento a la barra de navegación en el diseño:</p>
<p><strong>Views/Shared/_AdminActionsPartial.cshtml</strong></p>
<pre><code class="language-html">@using Microsoft.AspNetCore.Identity
@using AspNetCoreTodo.Models

@inject SignInManager&lt;ApplicationUser&gt; signInManager
@inject UserManager&lt;ApplicationUser&gt; userManager

@if (signInManager.IsSignedIn(User))
{
    var currentUser = await userManager.GetUserAsync(User);

    var isAdmin = currentUser != null
        &amp;&amp; await userManager.IsInRoleAsync(
            currentUser,
            Constants.AdministratorRole);

    if (isAdmin)
    {
        &lt;ul class=&quot;nav navbar-nav navbar-right&quot;&gt;
            &lt;li&gt;
                &lt;a asp-controller=&quot;ManageUsers&quot; 
                   asp-action=&quot;Index&quot;&gt;
                   Manage Users
                &lt;/a&gt;
            &lt;/li&gt;
        &lt;/ul&gt;
    }
}
</code></pre>
<blockquote>
<p>Es una convención nombrar vistas parciales compartidas que comienzan con un guión bajo <code>_</code>, pero no es obligatorio.</p>
</blockquote>
<p>Esta vista parcial primero utiliza el <code>SignInManager</code> para determinar rápidamente si el usuario está conectado. Si no lo está, el resto del código de vista se puede omitir. Si hay <strong>hay</strong> un usuario conectado, el <code>UserManager</code> se utiliza para buscar sus detalles y realizar una verificación de autorización con <code>IsInRoleAsync()</code>. Si todas las comprobaciones son correctas y el usuario es un administrador, se agrega un enlace <strong>Administrar usuarios</strong> a la barra de navegación.</p>
<p>Para incluir este parcial en el diseño principal, edite <code>_Layout.cshtml</code> y agréguelo a la sección de la barra de navegación:</p>
<p><strong>Views/Shared/_Layout.cshtml</strong></p>
<pre><code class="language-html">&lt;div class=&quot;navbar-collapse collapse&quot;&gt;
    &lt;ul class=&quot;nav navbar-nav&quot;&gt;
        &lt;!-- existing code here --&gt;
    &lt;/ul&gt;
    @await Html.PartialAsync(&quot;_LoginPartial&quot;)
    @await Html.PartialAsync(&quot;_AdminActionsPartial&quot;)
&lt;/div&gt;
</code></pre>
<p>Cuando inicie sesión con una cuenta de administrador, ahora verá un nuevo elemento en la parte superior derecha:</p>
<p><img src="manage-users.png" alt="Liga para administrar usuarios" /></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../../chapters/security-and-identity/using-identity-in-the-application.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../../chapters/security-and-identity/more-resources.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../../chapters/security-and-identity/using-identity-in-the-application.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../../chapters/security-and-identity/more-resources.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        
        <!-- Google Analytics Tag -->
        <script type="text/javascript">
            var localAddrs = ["localhost", "127.0.0.1", ""];

            // make sure we don't activate google analytics if the developer is
            // inspecting the book locally...
            if (localAddrs.indexOf(document.location.hostname) === -1) {
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-130293099-1', 'auto');
                ga('send', 'pageview');
            }
        </script>
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952787000309783" crossorigin="anonymous"></script>
        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
